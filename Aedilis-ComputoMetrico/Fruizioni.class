' Gambas class file


PUBLIC SUB Form_Open()

  ME.Center

END
PUBLIC SUB InserisciRiga(Contatore1 AS Integer, RowC AS Integer)
DIM Contatore AS Integer
DIM Contatore2 AS Integer
DIM parziale AS Float
DIM ContatoreQ AS Integer

     WITH ComputoMetrico
          Contatore2 = 0
          FOR Contatore = 0 TO ListaStampa.Count - 1
               SELECT ListaStampa[Contatore].Text
               CASE "Codice"
                    Insert(Contatore2, RowC - 1, .ListElCode[Contatore1].Text)
                    Contatore2 = Contatore2 + 1
               CASE "Descrizione Breve"
                    Insert(Contatore2, RowC - 1, .ListElDescrBreve[Contatore1].Text)
                    Contatore2 = Contatore2 + 1
               CASE "Descrizione Completa"
                    Insert(Contatore2, RowC - 1, .ListElDescr[Contatore1].Text)
                    Contatore2 = Contatore2 + 1
               CASE "Prezzo"
                    Insert(Contatore2, RowC - 1, .ListElPrezzo[Contatore1].Text & " €")
                    Contatore2 = Contatore2 + 1
               CASE "Sconto"   
                    Insert(Contatore2, RowC - 1, .ListElSconto[Contatore1].Text & " %")
                    Contatore2 = Contatore2 + 1
               CASE "UM"   
                    Insert(Contatore2, RowC - 1, .ListElUM[Contatore1].Text)
                    Contatore2 = Contatore2 + 1
               CASE "Quantità"   
                    parziale = 0
                    FOR contatoreQ = 0 TO .ListQuantitaId.Count - 1
                         IF (.ListQuantitaId[ContatoreQ].Text = .ListCmId[contatore1].Text) THEN 
                              parziale = parziale + .ListCMTot[contatoreQ].Text            
                         END IF
                    NEXT 
                    parziale = Globals.Approssima(parziale, 1)
                    Insert(Contatore2, RowC - 1, parziale)
                    Contatore2 = Contatore2 + 1
               CASE "Costo"   
                    parziale = 0
                    FOR contatoreQ = 0 TO .ListQuantitaId.Count - 1
                         IF (.ListQuantitaId[ContatoreQ].Text = .ListCmId[contatore1].Text) THEN 
                              parziale = parziale + .ListCMTot[contatoreQ].Text            
                         END IF
                    NEXT 
                    parziale = parziale * .ListElPrezzo[Contatore1].Text
                    parziale = parziale - (parziale * .ListElSconto[Contatore1].Text) / 100
                    parziale = Globals.Approssima(parziale, 0)
                    Insert(Contatore2, RowC - 1, parziale)
                    Contatore2 = Contatore2 + 1
               CASE "Costo(no sconto)"   
                    parziale = 0
                    FOR contatoreQ = 0 TO .ListQuantitaId.Count - 1
                         IF (.ListQuantitaId[ContatoreQ].Text = .ListCmId[contatore1].Text) THEN 
                              parziale = parziale + .ListCMTot[contatoreQ].Text            
                         END IF
                    NEXT 
                    parziale = parziale * .ListElPrezzo[Contatore1].Text                    
                    parziale = Globals.Approssima(parziale, 0)
                    Insert(Contatore2, RowC - 1, parziale)
                    Contatore2 = Contatore2 + 1
               CASE "Offerte (numerica)" OR "Offerte (letterale)"
                    Insert(Contatore2, RowC - 1, "")
                    Contatore2 = Contatore2 + 1
               END SELECT             
          NEXT 
     END WITH
END




PUBLIC SUB Button10_Click()

  ME.Close

END

PUBLIC SUB AResize(ColC AS Integer, RowC AS Integer) 
  
  AnteprimaFruizione.Anteprima.Columns.Count = ColC
  AnteprimaFruizione.Anteprima.Rows.Count = RowC
  
END

PUBLIC SUB Insert(ColC AS Integer, RowC AS Integer, Linea AS String) 
  'PRINT Colc & " / " & RowC & " = " & Linea
  AnteprimaFruizione.Anteprima[RowC, ColC].Text = Linea
  
END


PUBLIC SUB Button9_Click()

DIM linea AS String

DIM Contatore1 AS Integer
DIM Contatore2 AS Integer
DIM ContatoreCat AS Integer

DIM Contatore AS Integer
DIM RowC AS Integer
DIM ColC AS Integer

DIM parziale AS Float
DIM ContatoreQ AS Integer

CatIntestazione.Value = categorie.Value

WITH ComputoMetrico
'Intestazione

     AnteprimaFruizione.Anteprima.Clear
     AnteprimaFruizione.Intestazione.Clear
     AnteprimaFruizione.LineeCategorie.Clear
     AnteprimaFruizione.TotaleFondo.Clear
     AnteprimaFruizione.Copertina.Visible = FALSE
     
     AResize(ColC, RowC)
     
     FOR Contatore = 0 TO ListaStampaInt.Count - 1
          
          SELECT ListaStampaInt[Contatore].Text
               CASE "Titolo Progetto"
                    linea = "Titolo Progetto: " & Globals.ProjectName
               CASE "Totale Computo"
                    linea = "Totale Computo: " & ComputoMetrico.TotComputo.text & " €"
               CASE "Committente"
                    linea = "Committente: " & Globals.ProjectCommittente
               CASE "Tipo di Committente"
                    linea = "Tipo Committente: " & Globals.ProjectTipoComm
               CASE "Professionista"
                    linea = "Professionista: " & Globals.ProjectAutore
               CASE "Lista riassuntiva delle categorie"
                    linea = "Riassunto computo per categorie:"
                    FOR contatore1 = 0 TO .TotPerCategoria.Count - 1
                         AnteprimaFruizione.Intestazione.Text = AnteprimaFruizione.Intestazione.Text & linea & "\n"
                         linea = .TotPerCategoria[Contatore1].Text
                    NEXT 
          END SELECT 
           AnteprimaFruizione.Intestazione.Text = AnteprimaFruizione.Intestazione.Text & linea & "\n"
     NEXT   

     ColC = ListaStampa.Count
     RowC = 0
     
     ColC = ColC + 1 
     AResize(ColC, RowC)


     
IF (categorie.Value = FALSE) THEN 

     IF NOT (ColC = 1) THEN 
          Contatore2 = 0 'Colonna
          RowC = RowC + 1
          AResize(ColC, RowC)
          FOR Contatore = 0 TO ListaStampa.Count - 1     
               Insert(Contatore2, RowC - 1, ListaStampa[Contatore].Text)
               Contatore2 = Contatore2 + 1
          NEXT      
     END IF
     
     FOR Contatore1 = 0 TO .ListCMId.Count - 1
          IF (ListaStampa.Count > 0) THEN
               RowC = RowC + 1
               AResize(ColC, RowC)
          END IF 
     
          InserisciRiga(Contatore1, RowC)

     NEXT 
ELSE 
     IF (CatIntestazione.Value = FALSE) THEN 
          IF NOT (ColC = 1) THEN 
               Contatore2 = 0 'Colonna
               RowC = RowC + 1
               AResize(ColC, RowC)
               FOR Contatore = 0 TO ListaStampa.Count - 1     
                    Insert(Contatore2, RowC - 1, ListaStampa[Contatore].Text)
                    Contatore2 = Contatore2 + 1
               NEXT      
          END IF
     END IF
     
     FOR ContatoreCat = 0 TO .CategorieCM.Count - 2
     
          RowC = RowC + 1
          IF (colC = 0) THEN colC = 1
          AResize(ColC, RowC)
          IF (TotCat.Value = TRUE) THEN 
               .CategorieCM_Click()
               Insert(0, RowC - 1, .TotPerCategoria[ContatoreCat].Text)
          ELSE 
               Insert(0, RowC - 1, .CategorieCM[ContatoreCat].Text)
          END IF
          AnteprimaFruizione.LineeCategorie.Add(RowC - 1)
          IF (CatIntestazione.Value = TRUE) THEN 
          IF NOT (ColC = 1) THEN 
               Contatore2 = 0 'Colonna
               RowC = RowC + 1
               AResize(ColC, RowC)
               FOR Contatore = 0 TO ListaStampa.Count - 1     
                    Insert(Contatore2, RowC - 1, ListaStampa[Contatore].Text)
                    Contatore2 = Contatore2 + 1
               NEXT      
          END IF
          END IF
     
          FOR Contatore1 = 0 TO .ListCMId.Count - 1
               IF (ContatoreCat = .ListElCat[Contatore1].Text) THEN 
                    IF (ListaStampa.Count > 0) THEN
                         RowC = RowC + 1
                         AResize(ColC, RowC)
                    END IF 
     
                    InserisciRiga(Contatore1, RowC)
               END IF
          NEXT 
     
     NEXT 
     AnteprimaFruizione.LineeCategorie.Add(RowC)
END IF

  AnteprimaFruizione.Copertina.Visible = Copertina.Enabled
  IF (TotComputoFondo.Value = FALSE) THEN 
     AnteprimaFruizione.TotaleFondo.Text = ""
  ELSE
      AnteprimaFruizione.TotaleFondo.Text = ComputoMetrico.TotComputo.Text & " €"
  END IF
  AnteprimaFruizione.FastFruizione = FALSE
  AnteprimaFruizione.categorie = categorie.Value
  AnteprimaFruizione.UnaCatUnaPag = CategoriaPerPagina.Value
  AnteprimaFruizione.ristampaintestazione = CatIntestazione.Value
  AnteprimaFruizione.Show
  ME.Hide
END WITH 

END

PUBLIC SUB Button8_Click()

  

END

PUBLIC SUB AddInt_Click()

  IF NOT (ListaDatiInt.Current = NULL) THEN
     ListaStampaInt.Add(ListaDatiInt.Current.Text)
     ListaDatiInt.Remove(ListaDatiInt.Index)
  END IF

END

PUBLIC SUB RmInt_Click()


    IF NOT (ListaStampaInt.Current = NULL) THEN
     ListaDatiInt.Add(ListaStampaInt.Current.Text)
     ListaStampaInt.Remove(ListaStampaInt.Index)
  END IF


END

PUBLIC SUB RMDati_Click()

  IF NOT (ListaStampa.Current = NULL) THEN
     ListaDati.Add(ListaStampa.Current.Text)
     ListaStampa.Remove(ListaStampa.Index)
  END IF

END

PUBLIC SUB AddDati_Click()

  IF NOT (ListaDati.Current = NULL) THEN
     ListaStampa.Add(ListaDati.Current.Text)
     ListaDati.Remove(ListaDati.Index)
  END IF

END

PUBLIC SUB UpInt_Click()

DIM nameA AS String
DIM indice AS Integer

     IF NOT (ListaStampaInt.Index < 1) THEN 
    
          indice = ListaStampaInt.Index

          nameA = ListaStampaInt[indice].Text
          
          ListaStampaInt[indice].Text = ListaStampaInt[indice - 1].Text
     
          ListaStampaInt[indice - 1].Text = nameA
          
          ListaStampaInt.Index = indice - 1
     END IF  


END

PUBLIC SUB UpDati_Click()

DIM nameA AS String
DIM indice AS Integer

     IF NOT (ListaStampa.Index < 1) THEN 
    
          indice = ListaStampa.Index

          nameA = ListaStampa[indice].Text
          
          ListaStampa[indice].Text = ListaStampa[indice - 1].Text
     
          ListaStampa[indice - 1].Text = nameA
          
          ListaStampa.Index = indice - 1
     END IF  


END

PUBLIC SUB DownInt_Click()
DIM nameA AS String
DIM indice AS Integer

     IF NOT ((ListaStampaInt.Index < 0) OR (ListaStampaInt.Index = ListaStampaInt.Count - 1)) THEN 
    
          indice = ListaStampaInt.Index
          
          nameA = ListaStampaInt[indice].Text
          
          ListaStampaInt[indice].Text = ListaStampaInt[indice + 1].Text
          
          ListaStampaInt[indice + 1].Text = nameA
          
          
          ListaStampaInt.Index = indice + 1
     END IF  
  

END

PUBLIC SUB DownDati_Click()

DIM nameA AS String
DIM indice AS Integer

     IF NOT ((ListaStampa.Index < 0) OR (ListaStampa.Index = ListaStampa.Count - 1)) THEN 
    
          indice = ListaStampa.Index
          
          nameA = ListaStampa[indice].Text
          
          ListaStampa[indice].Text = ListaStampa[indice + 1].Text
          
          ListaStampa[indice + 1].Text = nameA
          
          
          ListaStampa.Index = indice + 1
     END IF  


END

PUBLIC SUB Categorie_Click()

  TotCat.enabled = categorie.Value
  CategoriaPerPagina.Enabled = categorie.Value
  CatIntestazione.Enabled = categorie.Value
  
END

PUBLIC SUB TotComputoFondo_Click()

  

END
